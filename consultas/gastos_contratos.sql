SELECT 
  T.CODEMPRESA,
T.IDMOV,
T.CODFILIAL,
T.CODLOC,
T.CODLOCENTREGA,
T.CODLOCDESTINO,
T.CODCFO,
T.NUMEROMOV,
T.SERIE,
T.CODTMV,
T.TIPO,
T.STATUS,
T.MOVIMPRESSO,
T.DOCIMPRESSO,
T.DATAEMISSAO,
T.DATASAIDA,
T.DATAEXTRA1,
T.DATAEXTRA2,
T.CODRPR,
T.COMISSAOREPRES,
T.CODCPG,
T.NUMEROTRIBUTOS,
T.VALORBRUTO,
T.VALORLIQUIDO,
T.VALOROUTROS,
T.PERCENTUALFRETE,
T.VALORFRETE,
T.PERCENTUALSEGURO,
T.VALORSEGURO,
T.PERCENTUALDESC,
T.VALORDESC,
T.PERCENTUALDESP,
T.VALORDESP,
T.PERCENTUALEXTRA1,
T.VALOREXTRA1,
T.PERCENTUALEXTRA2,
T.VALOREXTRA2,
T.PERCCOMISSAO,
T.CODMEN,
T.CODMEN2,
T.VIADETRANSPORTE,
T.PLACA,
T.CODETDPLACA,
T.PESOLIQUIDO,
T.PESOBRUTO,
T.NUMERO,
T.QUANTIDADE,
T.ESPECIE,
T.MARCA,
T.CODTB1FAT,
T.CODTB2FAT,
T.CODTB3FAT,
T.CODTB4FAT,
T.CODTB5FAT,
T.IDMOVRELAC,
T.IDMOVPEDDESDOBRADO,
T.DATAMOVIMENTO,
T.FLAGEXPORTACAO,
T.EMITEBOLETA,
T.CODMENDESCONTO,
T.CODMENDESPESA,
T.CODMENFRETE,
T.FRETECIFOUFOB,
T.FLAGEXPORFISC,
T.CODTRA,
T.DATACANCELAMENTOMOV,
T.CODCCUSTO,
T.CODVEN1,
T.CODUSUARIO,
T.CODFILIALENTREGA,
T.CODFILIALDESTINO,
T.CODDEPARTAMENTO,
T.CODEVENTO,
T.DATAENTREGA,
T.DATAPROGRAMACAO,
T.CODNAT,
T.CAMPOLIVRE1,
T.CAMPOLIVRE2,
T.CAMPOLIVRE3,
T.CAMPOLIVRE4,
T.CAMPOLIVRE5,
T.ULTIMAALTERACAO,
T.NUMEROCUPOM,
T.CODPORTADOR,
T.OBS_FECHAMENTO,
T.OBS_ABERTURA,
T.STATUS2,
T.NUMEROCAIXA,
T.PLACA_VEIC,
T.VALORTOTALPRODUTO,
T.VALORTOTALSERVICO,
T.CODTB1FIN,
T.CODTB2FIN,
T.CODTB3FIN,
T.IDOBJETO,
T.DATAABERTURA,
T.DATAENCERRAMENTO,
T.ENDERECOENTREGA,
T.STATUSPEDIDO,
T.NOMECONSUMIDOR,
T.STATUSCOMPRAS,
T.SEGUNDONUMERO,
T.CODCOTACAO,
T.PERCENTUALEXTRA3,
T.VALOREXTRA3,
T.PERCENTUALEXTRA4,
T.VALOREXTRA4,
T.COMBUSTIVEL,
T.KM,
T.CODCAIXA,
T.IDMOVCOMPOS,
T.VALORRECEBIDO,
T.PEDIDOBLOQUEADO,
T.USUARIOLIBPEDIDO,
T.STATUSCONTABIL,
T.VALORDESCITENS,
T.CHAVEABASTEC,
T.CODMOELANCAMENTO,
T.CHECKSUM,
T.CODMAQUINA,
T.IDLANOPERACAO,
T.CODPRODUTOR,
T.CODTABPRECO,
T.DESCONTOVENDA,
T.IDROMANEIO,
T.VENDASINC,
T.HORA,
T.PERCCOMISSAO2,
T.CODVEN2,
T.CODCFO2,
T.IDSESSAO,
T.VALORTROCA,
T.IDMOVTROCA,
T.STATUSPOSVENDA,
T.NFEIMPORTADA,
T.MODELODOC,
T.OBSCANCELAMENTO,
T.REGISTRADA,
T.DATAREGISTRO,
T.NOME_CAIXA,
T.ID_GERADO_CAIXA,
T.CODTIPOSERV,
T.RNTC,
T.RETEMISS,
T.CODMAQUINA2,
T.IDLANPLANTIO,
T.IDLANDEFENSIVO,
T.CONSUMIDORFINAL,
T.CODSAFRA,
T.IDPROPRIEDADE,
T.NUMERACAOVOLTRANSP,
T.DATACOTACAOMOEDA,
T.IDCIDADEPRESTACAOSERV,
T.IDCFOAUTO,
T.LATITUDE,
T.LONGITUDE,
T.CODMOTIVO,
T.NATUREZAOPERACAONFSE,
T.VALORDESCFIDELIZA,
T.PERCDESCFIDELIZA,
  'CONTRATO_BASE' AS tipo_movimento
FROM TMOV T
WHERE T.CODTMV = '2.2.13'
  AND T.STATUS <> 'C'  -- ignora cancelados

UNION ALL

SELECT 
  TREL.CODEMPRESA,
TREL.IDMOV,
TREL.CODFILIAL,
TREL.CODLOC,
TREL.CODLOCENTREGA,
TREL.CODLOCDESTINO,
TREL.CODCFO,
TREL.NUMEROMOV,
TREL.SERIE,
TREL.CODTMV,
TREL.TIPO,
TREL.STATUS,
TREL.MOVIMPRESSO,
TREL.DOCIMPRESSO,
TREL.DATAEMISSAO,
TREL.DATASAIDA,
TREL.DATAEXTRA1,
TREL.DATAEXTRA2,
TREL.CODRPR,
TREL.COMISSAOREPRES,
TREL.CODCPG,
TREL.NUMEROTRIBUTOS,
TREL.VALORBRUTO,
TREL.VALORLIQUIDO,
TREL.VALOROUTROS,
TREL.PERCENTUALFRETE,
TREL.VALORFRETE,
TREL.PERCENTUALSEGURO,
TREL.VALORSEGURO,
TREL.PERCENTUALDESC,
TREL.VALORDESC,
TREL.PERCENTUALDESP,
TREL.VALORDESP,
TREL.PERCENTUALEXTRA1,
TREL.VALOREXTRA1,
TREL.PERCENTUALEXTRA2,
TREL.VALOREXTRA2,
TREL.PERCCOMISSAO,
TREL.CODMEN,
TREL.CODMEN2,
TREL.VIADETRANSPORTE,
TREL.PLACA,
TREL.CODETDPLACA,
TREL.PESOLIQUIDO,
TREL.PESOBRUTO,
TREL.NUMERO,
TREL.QUANTIDADE,
TREL.ESPECIE,
TREL.MARCA,
TREL.CODTB1FAT,
TREL.CODTB2FAT,
TREL.CODTB3FAT,
TREL.CODTB4FAT,
TREL.CODTB5FAT,
TREL.IDMOVRELAC,
TREL.IDMOVPEDDESDOBRADO,
TREL.DATAMOVIMENTO,
TREL.FLAGEXPORTACAO,
TREL.EMITEBOLETA,
TREL.CODMENDESCONTO,
TREL.CODMENDESPESA,
TREL.CODMENFRETE,
TREL.FRETECIFOUFOB,
TREL.FLAGEXPORFISC,
TREL.CODTRA,
TREL.DATACANCELAMENTOMOV,
TREL.CODCCUSTO,
TREL.CODVEN1,
TREL.CODUSUARIO,
TREL.CODFILIALENTREGA,
TREL.CODFILIALDESTINO,
TREL.CODDEPARTAMENTO,
TREL.CODEVENTO,
TREL.DATAENTREGA,
TREL.DATAPROGRAMACAO,
TREL.CODNAT,
TREL.CAMPOLIVRE1,
TREL.CAMPOLIVRE2,
TREL.CAMPOLIVRE3,
TREL.CAMPOLIVRE4,
TREL.CAMPOLIVRE5,
TREL.ULTIMAALTERACAO,
TREL.NUMEROCUPOM,
TREL.CODPORTADOR,
TREL.OBS_FECHAMENTO,
TREL.OBS_ABERTURA,
TREL.STATUS2,
TREL.NUMEROCAIXA,
TREL.PLACA_VEIC,
TREL.VALORTOTALPRODUTO,
TREL.VALORTOTALSERVICO,
TREL.CODTB1FIN,
TREL.CODTB2FIN,
TREL.CODTB3FIN,
TREL.IDOBJETO,
TREL.DATAABERTURA,
TREL.DATAENCERRAMENTO,
TREL.ENDERECOENTREGA,
TREL.STATUSPEDIDO,
TREL.NOMECONSUMIDOR,
TREL.STATUSCOMPRAS,
TREL.SEGUNDONUMERO,
TREL.CODCOTACAO,
TREL.PERCENTUALEXTRA3,
TREL.VALOREXTRA3,
TREL.PERCENTUALEXTRA4,
TREL.VALOREXTRA4,
TREL.COMBUSTIVEL,
TREL.KM,
TREL.CODCAIXA,
TREL.IDMOVCOMPOS,
TREL.VALORRECEBIDO,
TREL.PEDIDOBLOQUEADO,
TREL.USUARIOLIBPEDIDO,
TREL.STATUSCONTABIL,
TREL.VALORDESCITENS,
TREL.CHAVEABASTEC,
TREL.CODMOELANCAMENTO,
TREL.CHECKSUM,
TREL.CODMAQUINA,
TREL.IDLANOPERACAO,
TREL.CODPRODUTOR,
TREL.CODTABPRECO,
TREL.DESCONTOVENDA,
TREL.IDROMANEIO,
TREL.VENDASINC,
TREL.HORA,
TREL.PERCCOMISSAO2,
TREL.CODVEN2,
TREL.CODCFO2,
TREL.IDSESSAO,
TREL.VALORTROCA,
TREL.IDMOVTROCA,
TREL.STATUSPOSVENDA,
TREL.NFEIMPORTADA,
TREL.MODELODOC,
TREL.OBSCANCELAMENTO,
TREL.REGISTRADA,
TREL.DATAREGISTRO,
TREL.NOME_CAIXA,
TREL.ID_GERADO_CAIXA,
TREL.CODTIPOSERV,
TREL.RNTC,
TREL.RETEMISS,
TREL.CODMAQUINA2,
TREL.IDLANPLANTIO,
TREL.IDLANDEFENSIVO,
TREL.CONSUMIDORFINAL,
TREL.CODSAFRA,
TREL.IDPROPRIEDADE,
TREL.NUMERACAOVOLTRANSP,
TREL.DATACOTACAOMOEDA,
TREL.IDCIDADEPRESTACAOSERV,
TREL.IDCFOAUTO,
TREL.LATITUDE,
TREL.LONGITUDE,
TREL.CODMOTIVO,
TREL.NATUREZAOPERACAONFSE,
TREL.VALORDESCFIDELIZA,
TREL.PERCDESCFIDELIZA,
  'RELACIONADO' AS tipo_movimento
FROM TMOVREL TR
JOIN TMOV TREL ON TREL.IDMOV = TR.IDMOVDESTINO
JOIN TMOV TBASE ON TBASE.IDMOV = TR.IDMOVORIGEM
WHERE TBASE.CODTMV = '2.2.13'
  AND TREL.STATUS <> 'C'  -- ignora relacionados cancelados
  AND TBASE.STATUS <> 'C' -- ignora bases canceladas
